// HeaderContainer.java
package com.stickpoint.ddmusic.page.node;

import javafx.geometry.Pos;
import javafx.scene.control.TextField;
import javafx.scene.layout.HBox;
import javafx.scene.layout.Priority;
import javafx.scene.layout.Region;
import javafx.scene.text.Font;
import javafx.stage.Stage;

/**
 * 顶部容器组件 - 包含搜索框和功能按钮
 * @author fntp
 * @date 2025/8/24
 */
public class HomePageHeaderContainer extends HBox {

    private final TextField searchField;
    private final SvgIcon menuButton;
    private final SvgIcon minimizeButton;
    private final SvgIcon maximizeButton;
    private boolean isMaximized = false;

    public HomePageHeaderContainer() {
        // 设置整体样式
        setStyle("-fx-background-color: #f5f5f5; -fx-padding: 10px;");
        setAlignment(Pos.CENTER_LEFT);
        setSpacing(20);
        // 设置固定高度
        setPrefHeight(60);

        // 创建搜索框
        searchField = new TextField();
        searchField.setPromptText("请输入 歌曲|歌手|专辑|MV ");
        searchField.setPrefWidth(120);
        searchField.setPrefHeight(36);
        searchField.setStyle("-fx-background-color: white; " +
                "-fx-background-radius: 10px; " +
                "-fx-border-radius: 10px; " +
                "-fx-border-color: #ddd; " +
                "-fx-border-width: 1px; " +
                "-fx-font-size: 14px; " +
                "-fx-padding: 0 12px;");

        searchField.setFont(Font.font("Microsoft YaHei", 14));
        // 设置不通过Tab键获得焦点
        searchField.setFocusTraversable(false);
        // 添加鼠标点击事件来获取焦点
        searchField.setOnMouseClicked(event -> searchField.requestFocus());

        // 让搜索框占据剩余空间
        HBox.setHgrow(searchField, Priority.ALWAYS);

        // 创建功能按钮区域
        // 改为HBox使按钮水平排列
        HBox buttonGroup = new HBox();
        buttonGroup.setSpacing(12);
        buttonGroup.setAlignment(Pos.CENTER_RIGHT);
        // 确保按钮组不会被压缩
        // 根据按钮数量调整
        buttonGroup.setMinWidth(80);
        // 添加右边距，使按钮组距离右边界有10px间距 上右下左
        HBox.setMargin(buttonGroup, new javafx.geometry.Insets(0, 10, 0, -5));
        HBox.setHgrow(buttonGroup, Priority.NEVER);
        // 菜单按钮
        menuButton = createIconButton(20, 20, "M940.12059658 335.12723721l-144.21298096 144.17548506c-14.2488123 14.21131552-33.18473408 22.04816221-53.35805302 22.0481622h-0.03749678a74.88125947 74.88125947 0 0 1-53.35805303-22.08565986l-144.25047861-144.17548418a74.80626592 74.80626592 0 0 1-22.01066543-53.35805303c0-20.17331894 7.7993499-39.1467375 22.01066543-53.35805303L689.15401279 84.1981502c14.21131552-14.2488123 33.18473408-22.08565898 53.35805303-22.08565987 20.21081572 0 39.1467375 7.83684668 53.3955498 22.08565986l144.21298096 144.17548418c14.28630908 14.2488123 22.12315664 33.18473408 22.12315665 53.35805303 0 20.21081572-7.83684668 39.1467375-22.12315665 53.39554981z m-34.64711191-72.10649004l-144.21298184-144.17548506a26.32280625 26.32280625 0 0 0-18.71094023-7.72435547 26.36030303 26.36030303 0 0 0-18.74843789 7.72435547l-144.21298096 144.17548506a26.28530947 26.28530947 0 0 0 0 37.42188135l144.21298096 144.17548418a27.11024033 27.11024033 0 0 0 37.45937812 0l144.21298184-144.17548418a26.28530947 26.28530947 0 0 0 0-37.42188135zM404.32775029 961.85000586H150.62389385a88.60511602 88.60511602 0 0 1-88.45512803-88.45512803v-253.55386846a88.53012158 88.53012158 0 0 1 88.45512803-88.45512802h253.70385644a88.53012158 88.53012158 0 0 1 88.45512803 88.45512802v253.55386846c0 48.74593711-39.67169414 88.41763125-88.45512803 88.45512803z m38.32180577-342.00899649c0-21.14823779-17.17356885-38.35930342-38.32180577-38.35930341H150.66139063c-21.18573457 0-38.39680019 17.21106562-38.3968002 38.35930341l0.03749678 253.55386846c0 21.14823779 17.17356885 38.35930342 38.35930341 38.35930342h253.66635967c21.14823779 0 38.32180664-17.21106562 38.32180576-38.35930342v-253.55386846zM404.32775029 496.9637501H150.62389385A88.56761836 88.56761836 0 0 1 62.16876582 408.50862207V154.95475273A88.56761836 88.56761836 0 0 1 150.62389385 66.49962471h253.70385644c23.51054092 0 45.70869023 9.22423096 62.46979365 25.98533437a87.7426875 87.7426875 0 0 1 25.98533438 62.46979365v253.55386935A88.53012158 88.53012158 0 0 1 404.32775029 496.9637501z m38.32180577-342.00899737c0-21.14823779-17.17356885-38.35930342-38.32180577-38.35930254H150.66139063c-21.18573457 0-38.39680019 17.21106562-38.3968002 38.35930254v253.55386935a38.43429698 38.43429698 0 0 0 38.39680019 38.35930253h253.66635967c21.14823779 0 38.32180664-17.21106562 38.32180576-38.35930254V154.95475273z m173.04807831 376.43112862h253.66635967a88.53012158 88.53012158 0 0 1 88.45512803 88.45512803v253.55386845c0 48.74593711-39.67169414 88.41763125-88.45512803 88.45512803H615.69763438a88.64261279 88.64261279 0 0 1-88.49262481-88.45512803v-253.55386846a88.56761836 88.56761836 0 0 1 88.49262481-88.45512802z m-38.35930341 342.00899648c0 21.14823779 17.21106562 38.35930342 38.35930342 38.35930342h253.66635966c21.14823779 0 38.35930342-17.21106562 38.35930254-38.35930342v-253.55386845c0-21.14823779-17.21106562-38.35930342-38.35930254-38.35930342H615.69763438c-21.14823779 0-38.35930342 17.21106562-38.35930342 38.35930342v253.55386845z");
        menuButton.setOnMouseClicked(event -> onMenuButtonClick());

        // 收起按钮
        minimizeButton = createIconButton(20, 20,"M397.963636 791.272727H162.909091c-25.6 0-46.545455-20.945455-46.545455-46.545454V186.181818c0-25.6 20.945455-46.545455 46.545455-46.545454h558.545454c25.6 0 46.545455 20.945455 46.545455 46.545454v290.909091c0 11.636364 11.636364 20.945455 23.272727 20.945455s23.272727-9.309091 23.272728-20.945455V186.181818c0-51.2-41.890909-93.090909-93.09091-93.090909H162.909091C111.709091 93.090909 69.818182 134.981818 69.818182 186.181818v558.545455c0 51.2 41.890909 93.090909 93.090909 93.090909h235.054545c11.636364 0 20.945455-11.636364 20.945455-23.272727s-9.309091-23.272727-20.945455-23.272728zM442.181818 256c-13.963636 0-23.272727 9.309091-23.272727 23.272727v162.909091h-162.909091c-13.963636 0-23.272727 9.309091-23.272727 23.272727s9.309091 23.272727 23.272727 23.272728h186.181818c13.963636 0 23.272727-9.309091 23.272727-23.272728v-186.181818c0-13.963636-11.636364-23.272727-23.272727-23.272727zM242.036364 265.309091c-9.309091 9.309091-9.309091 23.272727 0 32.581818l132.654545 132.654546c9.309091 9.309091 23.272727 9.309091 32.581818 0s9.309091-23.272727 0-32.581819l-132.654545-132.654545c-9.309091-9.309091-23.272727-9.309091-32.581818 0zM861.090909 558.545455H581.818182c-51.2 0-93.090909 41.890909-93.090909 93.090909v186.181818c0 51.2 41.890909 93.090909 93.090909 93.090909h279.272727c51.2 0 93.090909-41.890909 93.090909-93.090909v-186.181818c0-51.2-41.890909-93.090909-93.090909-93.090909z m46.545455 279.272727c0 25.6-20.945455 46.545455-46.545455 46.545454H581.818182c-25.6 0-46.545455-20.945455-46.545455-46.545454v-186.181818c0-25.6 20.945455-46.545455 46.545455-46.545455h279.272727c25.6 0 46.545455 20.945455 46.545455 46.545455v186.181818z");
        minimizeButton.setOnMouseClicked(event -> onMinimizeButtonClick());

        // 最大化按钮
        maximizeButton = createIconButton(20, 20,"M812.3 959.4H213.7c-81.6 0-148-66.4-148-148V212.9c0-81.6 66.4-148 148-148h598.5c81.6 0 148 66.4 148 148v598.5C960.3 893 893.9 959.4 812.3 959.4zM213.7 120.9c-50.7 0-92 41.3-92 92v598.5c0 50.7 41.3 92 92 92h598.5c50.7 0 92-41.3 92-92V212.9c0-50.7-41.3-92-92-92H213.7z");
        maximizeButton.setOnMouseClicked(event -> onMaximizeButtonClick());

        // 添加到按钮组
        buttonGroup.getChildren().addAll(menuButton, minimizeButton, maximizeButton);

        // 添加到主容器
        getChildren().addAll(searchField, buttonGroup);

    }

    /**
     * 创建图标按钮
     * @param width 宽度
     * @param height 高度
     * @return SvgIcon 图标按钮
     */
    private SvgIcon createIconButton(double width, double height, String iconPath) {
        SvgIcon icon = new SvgIcon(iconPath);
        icon.setIconSize(width, height);
        icon.setStyle("-fx-background-color: gray; " +
                "-fx-background-radius: 50%; " +
                "-fx-cursor: hand;");
        return icon;
    }

    /**
     * 菜单按钮点击事件
     */
    protected void onMenuButtonClick() {
        // 预留的菜单按钮点击事件处理
        System.out.println("菜单按钮被点击");
    }

    /**
     * 收起按钮点击事件
     */
    protected void onMinimizeButtonClick() {
        // 预留的收起按钮点击事件处理
        System.out.println("收起按钮被点击");
    }

    /**
     * 最大化按钮点击事件
     */
    protected void onMaximizeButtonClick() {
        // 先最大化
        Stage homepageStage = (Stage) this.getScene().getWindow();
        if (!isMaximized) {
            homepageStage.setMaximized(true);
            // 然后设置按钮样式为最小化按钮
            maximizeButton.modifyContent("M658.773333 752.64H365.226667c-51.2 0-92.16-40.96-92.16-92.16V365.226667c0-51.2 40.96-92.16 92.16-92.16h295.253333c51.2 0 92.16 40.96 92.16 92.16v295.253333c0 49.493333-42.666667 92.16-93.866667 92.16zM365.226667 322.56c-22.186667 0-40.96 18.773333-40.96 40.96v295.253333c0 22.186667 18.773333 40.96 40.96 40.96h295.253333c22.186667 0 40.96-18.773333 40.96-40.96V365.226667c0-22.186667-18.773333-40.96-40.96-40.96H365.226667zM203.093333 989.866667c-13.653333 0-25.6-11.946667-25.6-25.6v-117.76H59.733333c-13.653333 0-25.6-10.24-25.6-25.6s11.946667-25.6 25.6-25.6h143.36c13.653333 0 25.6 11.946667 25.6 25.6v143.36c0 13.653333-11.946667 25.6-25.6 25.6zM820.906667 989.866667c-13.653333 0-25.6-11.946667-25.6-25.6v-143.36c0-13.653333 11.946667-25.6 25.6-25.6h143.36c13.653333 0 25.6 11.946667 25.6 25.6s-11.946667 25.6-25.6 25.6h-117.76v117.76c0 13.653333-10.24 25.6-25.6 25.6zM203.093333 228.693333H59.733333c-13.653333 0-25.6-11.946667-25.6-25.6s11.946667-25.6 25.6-25.6h117.76V59.733333c0-13.653333 10.24-25.6 25.6-25.6s25.6 11.946667 25.6 25.6v143.36c0 13.653333-11.946667 25.6-25.6 25.6zM964.266667 228.693333h-143.36c-13.653333 0-25.6-11.946667-25.6-25.6V59.733333c0-13.653333 11.946667-25.6 25.6-25.6s25.6 11.946667 25.6 25.6v117.76h117.76c13.653333 0 25.6 11.946667 25.6 25.6s-11.946667 25.6-25.6 25.6z");
        }else {
            homepageStage.setMaximized(false);
            maximizeButton.modifyContent("M812.3 959.4H213.7c-81.6 0-148-66.4-148-148V212.9c0-81.6 66.4-148 148-148h598.5c81.6 0 148 66.4 148 148v598.5C960.3 893 893.9 959.4 812.3 959.4zM213.7 120.9c-50.7 0-92 41.3-92 92v598.5c0 50.7 41.3 92 92 92h598.5c50.7 0 92-41.3 92-92V212.9c0-50.7-41.3-92-92-92H213.7z");
        }
        // 更改标记
        isMaximized = !isMaximized;
    }

    // Getter 方法
    public TextField getSearchField() {
        return searchField;
    }

    public Region getMenuButton() {
        return menuButton;
    }

    public Region getMinimizeButton() {
        return minimizeButton;
    }

    public Region getMaximizeButton() {
        return maximizeButton;
    }
}
